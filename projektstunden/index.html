<!doctype html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Projektstundenerfassung</title>
  <link rel="stylesheet" href="./assets/fontawesome/css/all.min.css" />
  <link rel="stylesheet" href="./assets/css/styles.css" />
  <link rel="stylesheet" href="./assets/css/catalyst-ui-kit.css" />
</head>
<body class="catalyst-app">
  <div class="app-shell catalyst-layout">
    <aside class="catalyst-sidebar" aria-label="Hauptnavigation">
      <div class="catalyst-sidebar-header">
        <div class="catalyst-sidebar-brand">
          <div class="brand-row">
            <span class="app-icon" aria-hidden="true"><i class="fa-solid fa-stopwatch"></i></span>
            <h1>Projektstundenerfassung</h1>
          </div>
        </div>
      </div>

      <div class="catalyst-sidebar-body">
        <div class="catalyst-theme-toggle">
          <label class="theme-switch" for="themeToggleSwitch" aria-label="Darstellung wechseln">
            <input id="themeToggleSwitch" type="checkbox" />
            <span class="theme-switch-slider" aria-hidden="true">
              <i class="fa-regular fa-sun theme-icon theme-icon-sun" aria-hidden="true"></i>
              <i class="fa-regular fa-moon theme-icon theme-icon-moon" aria-hidden="true"></i>
            </span>
          </label>
        </div>
        <div class="catalyst-sidebar-spacer" aria-hidden="true"></div>
        <div class="catalyst-sidebar-actions">
          <button id="openFavoritesBtn" type="button" class="btn btn-secondary catalyst-nav-btn">
            <span class="catalyst-nav-icon" aria-hidden="true">
              <i class="fa-regular fa-star icon-regular fav-icon-regular" aria-hidden="true"></i>
              <i class="fa-solid fa-star icon-solid fav-icon-solid" aria-hidden="true"></i>
            </span>
            <span>Favoriten</span>
          </button>
          <button id="openReportBtn" type="button" class="btn btn-secondary catalyst-nav-btn">
            <span class="catalyst-nav-icon" aria-hidden="true">
              <i class="fa-regular fa-file-lines icon-regular report-icon-regular" aria-hidden="true"></i>
              <i class="fa-solid fa-file-lines icon-solid report-icon-solid" aria-hidden="true"></i>
            </span>
            <span>Report</span>
          </button>
        </div>
      </div>

      <div class="catalyst-sidebar-footer">
        <div class="topbar-profile-group catalyst-sidebar-profile">
          <div id="userProfileTrigger" class="user-chip" role="button" tabindex="0" aria-label="Profil und Einstellungen öffnen">
            <div id="userAvatar" class="user-avatar" aria-hidden="true">MM</div>
            <div class="user-meta">
              <strong id="userName">Max Mustermann</strong>
              <div class="user-subline">
                <span>ID: <span id="userId">01337</span></span>
                <span>•</span>
                <span id="userDepartment">Netzplanung</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </aside>

    <main class="layout catalyst-main-layout">
      <section class="card panel-card form-card">
        <div class="section-head">
          <div>
            <p class="muted">Ausgewählter Tag</p>
            <h2 id="selectedDateLabel">-</h2>
          </div>
          <div class="inline-stats">
            <div>
              <span class="muted">Gebuchte Stunden</span>
              <strong id="dayTotalHours">0,0</strong>
            </div>
            <div>
              <span class="muted">Monatssumme</span>
              <strong id="monthTotalHours">0,0</strong>
            </div>
          </div>
        </div>

        <div id="ruleBanner" class="rule-banner hidden" role="status" aria-live="polite"></div>

        <div class="quick-favorites">
          <span class="muted">Schnellfavoriten</span>
          <div id="favoriteQuickList" class="favorite-quick-list"></div>
        </div>

        <form id="logForm" class="log-form" novalidate>
          <div class="form-grid">
            <label>
              <span>Ort</span>
              <select id="locationSelect" required>
                <option value="">Bitte wählen</option>
              </select>
            </label>

            <label>
              <span>Kostenträger</span>
              <select id="costCenterSelect" required disabled>
                <option value="">Bitte zuerst Ort wählen</option>
              </select>
            </label>

            <label>
              <span>Stunden</span>
              <input id="hoursInput" type="text" placeholder="z.B. 3,5" inputmode="decimal" required />
              <div id="hoursQuickChips" class="hours-quick-chips"></div>
              <small>Ganzzahl oder Dezimalzahl (Komma/Punkt möglich)</small>
            </label>

            <label class="full-width">
              <div class="label-with-tag">
                <span>Kommentar</span>
                <span id="commentRequirementTag" class="tag optional">Optional</span>
              </div>
              <textarea id="commentInput" rows="3" placeholder="Tätigkeiten beschreiben"></textarea>
              <div id="commentSuggestionBox" class="comment-suggestion-box hidden" aria-live="polite"></div>
            </label>
          </div>

          <div class="form-actions">
            <button id="saveFavoriteBtn" type="button" class="btn btn-secondary">Als Favorit speichern</button>
            <button id="copyPreviousDayBtn" type="button" class="btn btn-secondary">Vortag kopieren</button>
            <button id="submitBtn" type="submit" class="btn btn-primary">Hinzufügen</button>
            <button id="cancelEditBtn" type="button" class="btn btn-ghost hidden">Bearbeitung abbrechen</button>
          </div>
        </form>
      </section>

      <aside class="card panel-card calendar-card">
        <div class="calendar-head">
          <div class="calendar-nav-group">
            <button id="prevMonthBtn" type="button" class="icon-btn" aria-label="Vorheriger Monat">◀</button>
            <h3 id="calendarMonthLabel">-</h3>
            <button id="nextMonthBtn" type="button" class="icon-btn" aria-label="Nächster Monat">▶</button>
          </div>
          <button id="goTodayBtn" type="button" class="btn btn-ghost">Heute</button>
        </div>
        <div class="weekdays">
          <span>Mo</span><span>Di</span><span>Mi</span><span>Do</span><span>Fr</span><span>Sa</span><span>So</span>
        </div>
        <div id="calendarGrid" class="calendar-grid"></div>
        <p class="legend">
          <span><i class="dot dot-gray"></i> keine Buchung</span>
          <span><i class="dot dot-green"></i> Buchung vorhanden</span>
          <span><i class="today-outline"></i> heute</span>
          <span>Rechtsklick: freier Tag</span>
        </p>
        <div id="calendarQualityInline" class="calendar-quality-inline"></div>
      </aside>

      <section class="card panel-card daily-log-card">
        <h3>Daily Log</h3>
        <div id="entryList" class="entry-list"></div>
      </section>

      <section class="card panel-card quality-card">
        <h3>Buchungsgüte</h3>
        <div class="quality-plan-row">
          <input id="workPlanInput" type="text" placeholder="Arbeitsplan, z.B. 9/9/9/9" />
          <button id="saveWorkPlanBtn" type="button" class="btn btn-secondary">Speichern</button>
        </div>
        <div id="workPlanStatus" class="muted quality-plan-status"></div>
        <div class="quality-main">
          <div class="quality-chart-block">
            <div id="qualityChart" class="quality-chart" role="img" aria-label="Buchungsgüte-Diagramm">
              <span id="qualityChartCenter">0%</span>
            </div>
            <small class="muted">Soll-Abdeckung</small>
          </div>
          <div class="quality-chart-block">
            <div id="qualityCompletenessChart" class="quality-chart quality-chart-status" role="img" aria-label="Vollständigkeitsstatus">
              <span id="qualityCompletenessCenter">0%</span>
            </div>
            <small id="qualityCompletenessLabel" class="muted">Vollständigkeit</small>
          </div>
          <div class="quality-metrics">
            <div><span class="muted">Soll</span><strong id="qualityTargetHours">0,0 h</strong></div>
            <div><span class="muted">Gebucht</span><strong id="qualityBookedHours">0,0 h</strong></div>
            <div><span class="muted">Abdeckung</span><strong id="qualityCoverage">0%</strong></div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <div id="calendarDayPopover" class="calendar-day-popover hidden" aria-hidden="true"></div>

  <div id="undoToast" class="undo-toast hidden" role="status" aria-live="polite">
    <span id="undoToastMessage">Eintrag gelöscht.</span>
    <button id="undoDeleteBtn" type="button" class="btn btn-ghost">Rückgängig</button>
    <button id="dismissUndoBtn" type="button" class="icon-btn" aria-label="Hinweis schließen">✕</button>
  </div>

  <div id="favoritesPopover" class="popover hidden" role="dialog" aria-modal="true" aria-labelledby="favoritesTitle">
    <div class="popover-card favorites-card">
      <div class="popover-head">
        <h3 id="favoritesTitle">Favoriten verwalten</h3>
        <button type="button" class="icon-btn" data-close="favoritesPopover">✕</button>
      </div>
      <div class="fav-add-row">
        <button id="saveFavoriteFromPopoverBtn" type="button" class="btn btn-primary">Aktuelle Auswahl als Favorit speichern</button>
      </div>
      <div class="favorite-suggestions-section">
        <p class="muted">Vorschläge aus häufigen Buchungen</p>
        <div id="favoriteSuggestionsList" class="favorite-suggestions-list"></div>
      </div>
      <div id="favoritesList" class="popover-list"></div>
      <div id="favoriteColorPicker" class="favorite-color-picker hidden"></div>
    </div>
  </div>

  <div id="duplicateEntryPopover" class="popover hidden" role="dialog" aria-modal="true" aria-labelledby="duplicateEntryTitle">
    <div class="popover-card" style="width:min(520px, calc(100% - 32px));">
      <div class="popover-head">
        <h3 id="duplicateEntryTitle">Ähnliche Buchung vorhanden</h3>
        <button id="dismissDuplicateEntryBtn" type="button" class="icon-btn" aria-label="Schließen">✕</button>
      </div>
      <p class="muted">Für diesen Tag gibt es bereits eine Buchung mit gleichem Ort und Kostenträger.</p>
      <div class="form-actions">
        <button id="combineDuplicateEntryBtn" type="button" class="btn btn-primary">Mit anderem Eintrag kombinieren</button>
        <button id="discardDuplicateEntryBtn" type="button" class="btn btn-ghost">Verwerfen</button>
      </div>
    </div>
  </div>

  <div id="reportPopover" class="popover hidden" role="dialog" aria-modal="true" aria-labelledby="reportTitle">
    <div class="popover-card">
      <div class="popover-head">
        <h3 id="reportTitle">Report erstellen</h3>
        <button type="button" class="icon-btn" data-close="reportPopover">✕</button>
      </div>
      <div class="form-grid compact">
        <label>
          <span>Von (Monat)</span>
          <input id="reportStartMonth" type="month" />
        </label>
        <label>
          <span>Bis (Monat)</span>
          <input id="reportEndMonth" type="month" />
        </label>
      </div>
      <div id="reportQualitySummary" class="report-quality-summary"></div>
      <div id="reportPreview" class="report-preview"></div>
      <div class="form-actions">
        <button id="downloadCsvBtn" type="button" class="btn btn-secondary">CSV herunterladen</button>
        <button id="downloadXlsxBtn" type="button" class="btn btn-primary">XLSX herunterladen</button>
      </div>
      <small class="muted">Aggregation: Ort (Ebene 1) → Kostenträger (Ebene 2)</small>
    </div>
  </div>

  <div id="settingsPopover" class="popover hidden" role="dialog" aria-modal="true" aria-labelledby="settingsTitle">
    <div class="popover-card settings-card">
      <div class="popover-head">
        <h3 id="settingsTitle">Profil & Daten</h3>
        <button type="button" class="icon-btn" data-close="settingsPopover">✕</button>
      </div>

      <div class="settings-section">
        <h4>Einstellungen</h4>
        <p class="muted">Favoriten (inkl. Farbe/Icon), Arbeitsplan und freie Tage</p>
        <div class="form-actions">
          <button id="exportSettingsBtn" type="button" class="btn btn-secondary">Einstellungen exportieren</button>
          <button id="importSettingsBtn" type="button" class="btn btn-ghost">Einstellungen importieren</button>
        </div>
        <input id="settingsImportInput" type="file" accept="application/json" class="hidden" />
      </div>

      <div class="settings-section settings-section-debug">
        <div class="settings-debug-head">
          <h4><i class="fa-solid fa-flask" aria-hidden="true"></i> Debug / Mockup</h4>
          <span class="settings-debug-badge">Nicht produktiv</span>
        </div>
        <p class="muted">Nur für Mockup-Zwecke: Testdaten erzeugen, Local Storage zurücksetzen und Stundenbuchungen importieren/exportieren.</p>
        <div class="form-actions">
          <button id="seedMockupEntriesBtn" type="button" class="btn btn-secondary">Debug: Projektstundenliste zufällig befüllen</button>
          <button id="clearMockupStorageBtn" type="button" class="btn btn-ghost">Debug: Local Storage bereinigen</button>
        </div>
        <div class="form-actions">
          <button id="exportEntriesDebugBtn" type="button" class="btn btn-secondary">Debug: Stunden exportieren</button>
          <button id="importEntriesDebugBtn" type="button" class="btn btn-ghost">Debug: Stunden importieren</button>
        </div>
        <input id="entriesImportInput" type="file" accept="application/json" class="hidden" />
      </div>
    </div>
  </div>

  <script src="./assets/xlsx.full.min.js"></script>
  <script src="./assets/js/app.js" defer></script>
</body>
</html>
